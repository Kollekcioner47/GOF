–ü—Ä–∞–∫—Ç–∏–∫–∞ "–ì–æ—Ä—É—Ç–∏–Ω—ã –∏ –∫–∞–Ω–∞–ª—ã –≤ Go –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤"

–®–∞–≥ 1: Hello World –≥–æ—Ä—É—Ç–∏–Ω–∞
–ß—Ç–æ –∏–∑—É—á–∞–µ–º:
–ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫ –≥–æ—Ä—É—Ç–∏–Ω—ã
–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–µ–∂–¥—É main –∏ –≥–æ—Ä—É—Ç–∏–Ω–æ–π

–ö–æ–¥:

go
package main

import (
    "fmt"
    "time"
)

func main() {
    // –ó–∞–ø—É—Å–∫–∞–µ–º –≥–æ—Ä—É—Ç–∏–Ω—É
    go func() {
        fmt.Println("–ü—Ä–∏–≤–µ—Ç –∏–∑ –≥–æ—Ä—É—Ç–∏–Ω—ã!")
    }()

    // –î–∞–µ–º –≥–æ—Ä—É—Ç–∏–Ω–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è
    time.Sleep(100 * time.Millisecond)
    fmt.Println("–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å")
}

–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:
–°—Ç—Ä–æ–∫–∞ 10: go func() {...}() –∑–∞–ø—É—Å–∫–∞–µ—Ç –∞–Ω–æ–Ω–∏–º–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –∫–∞–∫ –≥–æ—Ä—É—Ç–∏–Ω—É
–°—Ç—Ä–æ–∫–∞ 14: time.Sleep –¥–∞–µ—Ç –≤—Ä–µ–º—è –≥–æ—Ä—É—Ç–∏–Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è (–∏–Ω–∞—á–µ main –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —Ä–∞–Ω—å—à–µ)
–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ go –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ

–ü—Ä–æ–≤–µ—Ä—è–µ–º:
–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É:
go run step1.go
–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:


–ü—Ä–∏–≤–µ—Ç –∏–∑ –≥–æ—Ä—É—Ç–∏–Ω—ã!
–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å
–ó–∞–¥–∞–Ω–∏–µ:
–£–±–µ—Ä–∏—Ç–µ time.Sleep - —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?
–ó–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≥–æ—Ä—É—Ç–∏–Ω —Å —Ä–∞–∑–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

–®–∞–≥ 2: –ù–µ—Å–∫–æ–ª—å–∫–æ –≥–æ—Ä—É—Ç–∏–Ω —Å WaitGroup
–ß—Ç–æ –∏–∑—É—á–∞–µ–º:
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ sync.WaitGroup –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –≥–æ—Ä—É—Ç–∏–Ω
–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–º

–ö–æ–¥:

go
package main

import (
    "fmt"
    "sync"
)

func main() {
    var wg sync.WaitGroup
    
    for i := 1; i <= 3; i++ {
        wg.Add(1) // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
        
        go func(id int) {
            defer wg.Done() // –£–º–µ–Ω—å—à–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ
            fmt.Printf("–ì–æ—Ä—É—Ç–∏–Ω–∞ %d –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—É\n", id)
            // –ò–º–∏—Ç–∏—Ä—É–µ–º —Ä–∞–±–æ—Ç—É
            fmt.Printf("–ì–æ—Ä—É—Ç–∏–Ω–∞ %d –∑–∞–≤–µ—Ä—à–∏–ª–∞ —Ä–∞–±–æ—Ç—É\n", id)
        }(i)
    }
    
    wg.Wait() // –ñ–¥–µ–º, –ø–æ–∫–∞ —Å—á–µ—Ç—á–∏–∫ –Ω–µ —Å—Ç–∞–Ω–µ—Ç 0
    fmt.Println("–í—Å–µ –≥–æ—Ä—É—Ç–∏–Ω—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å")
}

–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:
wg.Add(1): —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –Ω–∞ 1 –ø–µ—Ä–µ–¥ –∫–∞–∂–¥–æ–π –≥–æ—Ä—É—Ç–∏–Ω–æ–π
defer wg.Done(): –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –ø—Ä–∏ –ª—é–±–æ–º –≤—ã—Ö–æ–¥–µ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏
wg.Wait(): –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ main –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –≥–æ—Ä—É—Ç–∏–Ω

–ü—Ä–æ–≤–µ—Ä—è–µ–º:
go run step2.go
–í—ã–≤–æ–¥ (–ø–æ—Ä—è–¥–æ–∫ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è):


–ì–æ—Ä—É—Ç–∏–Ω–∞ 3 –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—É
–ì–æ—Ä—É—Ç–∏–Ω–∞ 1 –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—É
–ì–æ—Ä—É—Ç–∏–Ω–∞ 3 –∑–∞–≤–µ—Ä—à–∏–ª–∞ —Ä–∞–±–æ—Ç—É
–ì–æ—Ä—É—Ç–∏–Ω–∞ 2 –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—É
–ì–æ—Ä—É—Ç–∏–Ω–∞ 1 –∑–∞–≤–µ—Ä—à–∏–ª–∞ —Ä–∞–±–æ—Ç—É
–ì–æ—Ä—É—Ç–∏–Ω–∞ 2 –∑–∞–≤–µ—Ä—à–∏–ª–∞ —Ä–∞–±–æ—Ç—É
–í—Å–µ –≥–æ—Ä—É—Ç–∏–Ω—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å

–ó–∞–¥–∞–Ω–∏–µ:
–î–æ–±–∞–≤—å—Ç–µ time.Sleep(time.Second) –≤–Ω—É—Ç—Ä—å –≥–æ—Ä—É—Ç–∏–Ω—ã
–ó–∞–ø—É—Å—Ç–∏—Ç–µ 10 –≥–æ—Ä—É—Ç–∏–Ω –≤–º–µ—Å—Ç–æ 3

–®–∞–≥ 3: –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –∫–∞–Ω–∞–ª
–ß—Ç–æ –∏–∑—É—á–∞–µ–º:
–°–æ–∑–¥–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤ —Å make(chan —Ç–∏–ø)
–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –∫–∞–Ω–∞–ª —á–µ—Ä–µ–∑ –∫–∞–Ω–∞–ª <- –¥–∞–Ω–Ω—ã–µ

–ö–æ–¥:

go
package main

import (
    "fmt"
    "sync"
)

func main() {
    var wg sync.WaitGroup
    ch := make(chan string) // –°–æ–∑–¥–∞–µ–º –∫–∞–Ω–∞–ª –¥–ª—è —Å—Ç—Ä–æ–∫
    
    // –ì–æ—Ä—É—Ç–∏–Ω–∞-–æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å
    wg.Add(1)
    go func() {
        defer wg.Done()
        
        for i := 1; i <= 5; i++ {
            msg := fmt.Sprintf("–°–æ–æ–±—â–µ–Ω–∏–µ %d", i)
            ch <- msg // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –∫–∞–Ω–∞–ª
            fmt.Printf("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: %s\n", msg)
        }
        close(ch) // –ó–∞–∫—Ä—ã–≤–∞–µ–º –∫–∞–Ω–∞–ª –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
    }()
    
    wg.Wait()
}

–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:
–°—Ç—Ä–æ–∫–∞ 12: make(chan string) —Å–æ–∑–¥–∞–µ—Ç –Ω–µ–±—É—Ñ–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª
–°—Ç—Ä–æ–∫–∞ 20: ch <- msg –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ (–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, –ø–æ–∫–∞ –¥–∞–Ω–Ω—ã–µ –Ω–µ –±—É–¥—É—Ç –ø—Ä–æ—á–∏—Ç–∞–Ω—ã)
–°—Ç—Ä–æ–∫–∞ 24: close(ch) –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –∫–∞–Ω–∞–ª - –≤–∞–∂–Ω–æ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è deadlock

–ü—Ä–æ–≤–µ—Ä—è–µ–º:
–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–∏—Å–Ω–µ—Ç! –ü–æ—á–µ–º—É? –ö–∞–Ω–∞–ª –Ω–µ —á–∏—Ç–∞–µ—Ç—Å—è, –æ—Ç–ø—Ä–∞–≤–∫–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è.

–ó–∞–¥–∞–Ω–∏–µ:
–ü–æ–∫–∞ –Ω–µ –∏—Å–ø—Ä–∞–≤–ª—è–µ–º - –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —à–∞–≥—É 4.

–®–∞–≥ 4: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑ –∫–∞–Ω–∞–ª–∞ –≤ main
–ß—Ç–æ –∏–∑—É—á–∞–µ–º:
–ß—Ç–µ–Ω–∏–µ –∏–∑ –∫–∞–Ω–∞–ª–∞ —á–µ—Ä–µ–∑ –¥–∞–Ω–Ω—ã–µ <- –∫–∞–Ω–∞–ª
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ range –¥–ª—è –∫–∞–Ω–∞–ª–æ–≤

–ö–æ–¥:

go
package main

import (
    "fmt"
    "sync"
)

func main() {
    var wg sync.WaitGroup
    ch := make(chan string)
    
    // –ì–æ—Ä—É—Ç–∏–Ω–∞-–æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å
    wg.Add(1)
    go func() {
        defer wg.Done()
        
        for i := 1; i <= 5; i++ {
            msg := fmt.Sprintf("–°–æ–æ–±—â–µ–Ω–∏–µ %d", i)
            ch <- msg
            fmt.Printf("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: %s\n", msg)
        }
        close(ch)
    }()
    
    // –ì–ª–∞–≤–Ω–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞ - –ø–æ–ª—É—á–∞—Ç–µ–ª—å
    for msg := range ch { // –ß–∏—Ç–∞–µ–º –ø–æ–∫–∞ –∫–∞–Ω–∞–ª –Ω–µ –∑–∞–∫—Ä–æ–µ—Ç—Å—è
        fmt.Printf("–ü–æ–ª—É—á–µ–Ω–æ: %s\n", msg)
    }
    
    wg.Wait()
    fmt.Println("–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞")
}

–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:
–°—Ç—Ä–æ–∫–∞ 28: for msg := range ch —á–∏—Ç–∞–µ—Ç –∏–∑ –∫–∞–Ω–∞–ª–∞ –¥–æ –µ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è
–ü–æ—Å–ª–µ close(ch) —Ü–∏–∫–ª range –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è
–ü–æ—Ä—è–¥–æ–∫: —Å–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å–∫–∞–µ–º –ø–æ–ª—É—á–∞—Ç–µ–ª—è, –∑–∞—Ç–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è

–ü—Ä–æ–≤–µ—Ä—è–µ–º:

bash
go run step4.go

–í—ã–≤–æ–¥:
–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: –°–æ–æ–±—â–µ–Ω–∏–µ 1
–ü–æ–ª—É—á–µ–Ω–æ: –°–æ–æ–±—â–µ–Ω–∏–µ 1
–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: –°–æ–æ–±—â–µ–Ω–∏–µ 2
–ü–æ–ª—É—á–µ–Ω–æ: –°–æ–æ–±—â–µ–Ω–∏–µ 2
...
–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
–ó–∞–¥–∞–Ω–∏–µ:
–î–æ–±–∞–≤—å—Ç–µ –≤—Ç–æ—Ä—É—é –≥–æ—Ä—É—Ç–∏–Ω—É-–æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ time.Sleep –¥–ª—è –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –æ—Ç–ø—Ä–∞–≤–∫–∞–º–∏

–®–∞–≥ 5: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª–∞–π—Å–∞ URL
–ß—Ç–æ –∏–∑—É—á–∞–µ–º:
–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–∞—Å—Å–∏–≤–∞
–ü–æ–ª—É—á–µ–Ω–∏–µ HTTP —Å—Ç–∞—Ç—É—Å–æ–≤

–ö–æ–¥:

go
package main

import (
    "fmt"
    "net/http"
    "sync"
    "time"
)

type Result struct {
    URL    string
    Status int
    Err    error
}

func main() {
    urls := []string{
        "https://google.com",
        "https://yandex.ru",
        "https://github.com",
        "https://stackoverflow.com",
        "https://go.dev",
    }
    
    start := time.Now()
    var wg sync.WaitGroup
    results := make(chan Result, len(urls))
    
    for _, url := range urls {
        wg.Add(1)
        go func(u string) {
            defer wg.Done()
            
            resp, err := http.Get(u)
            if err != nil {
                results <- Result{URL: u, Err: err}
                return
            }
            defer resp.Body.Close()
            
            results <- Result{URL: u, Status: resp.StatusCode}
        }(url)
    }
    
    wg.Wait()
    close(results)
    
    for r := range results {
        if r.Err != nil {
            fmt.Printf("%s: –æ—à–∏–±–∫–∞ - %v\n", r.URL, r.Err)
        } else {
            fmt.Printf("%s: —Å—Ç–∞—Ç—É—Å %d\n", r.URL, r.Status)
        }
    }
    
    fmt.Printf("–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: %v\n", time.Since(start))
}

–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:
–ö–∞–∂–¥–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–≤–æ–π URL
–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ –±—É—Ñ–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª
defer resp.Body.Close() –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã
–ò–∑–º–µ—Ä—è–µ–º –≤—Ä–µ–º—è –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π
–ü—Ä–æ–≤–µ—Ä—è–µ–º:


go run step5.go

–í—ã–≤–æ–¥:

https://google.com: —Å—Ç–∞—Ç—É—Å 200
https://yandex.ru: —Å—Ç–∞—Ç—É—Å 200
...
–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 1.2s
–ó–∞–¥–∞–Ω–∏–µ:
–î–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ URL (10+)
–°—Ä–∞–≤–Ω–∏—Ç–µ –≤—Ä–µ–º—è —Å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º

–®–∞–≥ 6: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≥–æ—Ä—É—Ç–∏–Ω (worker pool)
–ß—Ç–æ –∏–∑—É—á–∞–µ–º:
–°–æ–∑–¥–∞–Ω–∏–µ –ø—É–ª–∞ –≤–æ—Ä–∫–µ—Ä–æ–≤
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±—É—Ñ–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ –¥–ª—è —Å–µ–º–∞—Ñ–æ—Ä–æ–≤

–ö–æ–¥:

go
package main

import (
    "fmt"
    "net/http"
    "sync"
    "time"
)

func main() {
    urls := []string{
        "https://google.com", "https://yandex.ru", "https://github.com",
        "https://stackoverflow.com", "https://go.dev", "https://example.com",
        "https://httpbin.org/status/200", "https://httpbin.org/status/404",
        "https://httpbin.org/status/500", "https://httpbin.org/delay/2",
    }
    
    start := time.Now()
    const maxWorkers = 3 // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –≥–æ—Ä—É—Ç–∏–Ω
    
    var wg sync.WaitGroup
    results := make(chan string, len(urls))
    semaphore := make(chan struct{}, maxWorkers) // –ë—É—Ñ–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª –∫–∞–∫ —Å–µ–º–∞—Ñ–æ—Ä
    
    for _, url := range urls {
        wg.Add(1)
        go func(u string) {
            defer wg.Done()
            
            // –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ–º —Å–ª–æ—Ç
            semaphore <- struct{}{}
            defer func() { <-semaphore }() // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º —Å–ª–æ—Ç
            
            resp, err := http.Get(u)
            if err != nil {
                results <- fmt.Sprintf("%s: –æ—à–∏–±–∫–∞ - %v", u, err)
                return
            }
            defer resp.Body.Close()
            
            results <- fmt.Sprintf("%s: %d", u, resp.StatusCode)
        }(url)
    }
    
    wg.Wait()
    close(results)
    
    for r := range results {
        fmt.Println(r)
    }
    
    fmt.Printf("–í—Ä–µ–º—è —Å %d –≤–æ—Ä–∫–µ—Ä–∞–º–∏: %v\n", maxWorkers, time.Since(start))
}

–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:
semaphore := make(chan struct{}, maxWorkers) —Å–æ–∑–¥–∞–µ—Ç —Å–µ–º–∞—Ñ–æ—Ä
semaphore <- struct{}{} –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç —Å–ª–æ—Ç (–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –µ—Å–ª–∏ –≤—Å–µ –∑–∞–Ω—è—Ç—ã)
<-semaphore –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Å–ª–æ—Ç
–¢–æ–ª—å–∫–æ maxWorkers –≥–æ—Ä—É—Ç–∏–Ω –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

–ü—Ä–æ–≤–µ—Ä—è–µ–º:
go run step6.go
–í—ã–≤–æ–¥ –ø–æ–∫–∞–∂–µ—Ç, —á—Ç–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ 3 URL.

–ó–∞–¥–∞–Ω–∏–µ:
–ò–∑–º–µ–Ω–∏—Ç–µ maxWorkers –Ω–∞ 1, 5, 10 –∏ —Å—Ä–∞–≤–Ω–∏—Ç–µ –≤—Ä–µ–º—è
–î–æ–±–∞–≤—å—Ç–µ –≤—ã–≤–æ–¥ –Ω–æ–º–µ—Ä–∞ –≤–æ—Ä–∫–µ—Ä–∞ –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏

‚è±Ô∏è –®–∞–≥ 7: –¢–∞–π–º–∞—É—Ç—ã –∏ graceful stop
–ß—Ç–æ –∏–∑—É—á–∞–µ–º:
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –æ—Ç–º–µ–Ω—ã –æ–ø–µ—Ä–∞—Ü–∏–π
Graceful shutdown –ø–æ Ctrl+C

–ö–æ–¥:

go
package main

import (
    "context"
    "fmt"
    "net/http"
    "os"
    "os/signal"
    "sync"
    "syscall"
    "time"
)

func worker(ctx context.Context, id int, url string, results chan<- string, wg *sync.WaitGroup) {
    defer wg.Done()
    
    req, err := http.NewRequestWithContext(ctx, "GET", url, nil)
    if err != nil {
        results <- fmt.Sprintf("–í–æ—Ä–∫–µ—Ä %d: –æ—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ %s - %v", id, url, err)
        return
    }
    
    client := &http.Client{Timeout: 5 * time.Second}
    resp, err := client.Do(req)
    
    select {
    case <-ctx.Done():
        results <- fmt.Sprintf("–í–æ—Ä–∫–µ—Ä %d: –æ—Ç–º–µ–Ω–µ–Ω %s", id, url)
        return
    default:
    }
    
    if err != nil {
        results <- fmt.Sprintf("–í–æ—Ä–∫–µ—Ä %d: %s - %v", id, url, err)
        return
    }
    defer resp.Body.Close()
    
    results <- fmt.Sprintf("–í–æ—Ä–∫–µ—Ä %d: %s - %d", id, url, resp.StatusCode)
}

func main() {
    urls := []string{
        "https://google.com", "https://yandex.ru", "https://github.com",
        "https://httpbin.org/delay/3", "https://httpbin.org/delay/5",
        "https://go.dev", "https://example.com",
    }
    
    // –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å —Ç–∞–π–º–∞—É—Ç–æ–º
    ctx, cancel := context.WithTimeout(context.Background(), 10*time.Second)
    defer cancel()
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ Ctrl+C
    sigChan := make(chan os.Signal, 1)
    signal.Notify(sigChan, os.Interrupt, syscall.SIGTERM)
    
    go func() {
        <-sigChan
        fmt.Println("\n–ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª –æ—Å—Ç–∞–Ω–æ–≤–∫–∏...")
        cancel()
    }()
    
    const maxWorkers = 2
    var wg sync.WaitGroup
    results := make(chan string, len(urls))
    semaphore := make(chan struct{}, maxWorkers)
    
    fmt.Println("–ù–∞—á–∏–Ω–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É... (Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏)")
    
    for i, url := range urls {
        wg.Add(1)
        semaphore <- struct{}{}
        
        go func(id int, u string) {
            defer func() { <-semaphore }()
            worker(ctx, id, u, results, &wg)
        }(i+1, url)
    }
    
    // –ì–æ—Ä—É—Ç–∏–Ω–∞ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è results –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤
    go func() {
        wg.Wait()
        close(results)
    }()
    
    // –ß—Ç–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    for r := range results {
        fmt.Println(r)
    }
    
    fmt.Println("–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞")
}

–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:
context.WithTimeout —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –æ–±—â–∏–π —Ç–∞–π–º–∞—É—Ç
http.NewRequestWithContext —Å–≤—è–∑—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
signal.Notify –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç Ctrl+C
–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–∏–≥–Ω–∞–ª–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è cancel() –¥–ª—è –æ—Ç–º–µ–Ω—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

–ü—Ä–æ–≤–µ—Ä—è–µ–º:
–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É
–ù–∞–∂–º–∏—Ç–µ Ctrl+C –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
–í–∏–¥–∏—Ç–µ graceful shutdown

–ü–û–õ–ù–´–ô –ü–†–û–ï–ö–¢: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π checker —Å—Ç–∞—Ç—É—Å–æ–≤ URL
–§–∞–π–ª: url_checker.go

go
package main

import (
    "context"
    "fmt"
    "net/http"
    "os"
    "os/signal"
    "sync"
    "syscall"
    "time"
)

// Result —Ö—Ä–∞–Ω–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ URL
type Result struct {
    URL    string
    Status int
    Err    error
    Time   time.Duration
}

// Worker –ø—É–ª –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
type WorkerPool struct {
    maxWorkers int
    semaphore  chan struct{}
    client     *http.Client
}

// NewWorkerPool —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π –ø—É–ª –≤–æ—Ä–∫–µ—Ä–æ–≤
func NewWorkerPool(maxWorkers int, timeout time.Duration) *WorkerPool {
    return &WorkerPool{
        maxWorkers: maxWorkers,
        semaphore:  make(chan struct{}, maxWorkers),
        client: &http.Client{
            Timeout: timeout,
        },
    }
}

// CheckURL –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–¥–∏–Ω URL
func (wp *WorkerPool) CheckURL(ctx context.Context, url string) Result {
    start := time.Now()
    
    req, err := http.NewRequestWithContext(ctx, "GET", url, nil)
    if err != nil {
        return Result{URL: url, Err: err, Time: time.Since(start)}
    }
    
    resp, err := wp.client.Do(req)
    if err != nil {
        return Result{URL: url, Err: err, Time: time.Since(start)}
    }
    defer resp.Body.Close()
    
    return Result{
        URL:    url,
        Status: resp.StatusCode,
        Time:   time.Since(start),
    }
}

// ProcessUrls –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ URL –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
func (wp *WorkerPool) ProcessUrls(ctx context.Context, urls []string) []Result {
    var wg sync.WaitGroup
    results := make(chan Result, len(urls))
    allResults := make([]Result, 0, len(urls))
    
    for _, url := range urls {
        wg.Add(1)
        
        go func(u string) {
            defer wg.Done()
            
            // –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ–º —Å–ª–æ—Ç –≤ –ø—É–ª–µ
            wp.semaphore <- struct{}{}
            defer func() { <-wp.semaphore }()
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –æ—Ç–º–µ–Ω–µ–Ω –ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç
            select {
            case <-ctx.Done():
                results <- Result{URL: u, Err: ctx.Err()}
                return
            default:
            }
            
            // –í—ã–ø–æ–ª–Ω—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
            result := wp.CheckURL(ctx, u)
            results <- result
        }(url)
    }
    
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –∫–∞–Ω–∞–ª –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –≥–æ—Ä—É—Ç–∏–Ω
    go func() {
        wg.Wait()
        close(results)
    }()
    
    // –°–æ–±–∏—Ä–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    for result := range results {
        allResults = append(allResults, result)
    }
    
    return allResults
}

func main() {
    // –¢–µ—Å—Ç–æ–≤—ã–µ URL
    urls := []string{
        "https://google.com",
        "https://yandex.ru",
        "https://github.com",
        "https://stackoverflow.com",
        "https://go.dev",
        "https://example.com",
        "https://httpbin.org/status/200",
        "https://httpbin.org/status/404",
        "https://httpbin.org/status/500",
        "https://httpbin.org/delay/2",
        "https://httpbin.org/delay/4",
        "https://nonexistent.website",
    }
    
    fmt.Printf("–ü—Ä–æ–≤–µ—Ä—è–µ–º %d URL...\n\n", len(urls))
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
    const maxWorkers = 5
    const timeout = 30 * time.Second
    const totalTimeout = 15 * time.Second
    
    // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å —Ç–∞–π–º–∞—É—Ç–æ–º
    ctx, cancel := context.WithTimeout(context.Background(), totalTimeout)
    defer cancel()
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ Ctrl+C
    sigChan := make(chan os.Signal, 1)
    signal.Notify(sigChan, os.Interrupt, syscall.SIGTERM)
    go func() {
        <-sigChan
        fmt.Println("\nüî¥ –ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª –æ—Å—Ç–∞–Ω–æ–≤–∫–∏, –∑–∞–≤–µ—Ä—à–∞–µ–º —Ä–∞–±–æ—Ç—É...")
        cancel()
    }()
    
    // –°–æ–∑–¥–∞–µ–º –ø—É–ª –≤–æ—Ä–∫–µ—Ä–æ–≤
    wp := NewWorkerPool(maxWorkers, timeout)
    
    // –ó–∞–º–µ—Ä –≤—Ä–µ–º–µ–Ω–∏
    start := time.Now()
    
    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º URL
    results := wp.ProcessUrls(ctx, urls)
    
    elapsed := time.Since(start)
    
    // –í—ã–≤–æ–¥–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    success, failed := 0, 0
    for _, r := range results {
        if r.Err != nil {
            fmt.Printf("‚ùå %-40s –û–®–ò–ë–ö–ê: %-30v (–≤—Ä–µ–º—è: %v)\n", r.URL, r.Err, r.Time.Round(time.Millisecond))
            failed++
        } else {
            emoji := "‚úÖ"
            if r.Status >= 400 {
                emoji = "‚ö†Ô∏è"
                failed++
            } else {
                success++
            }
            fmt.Printf("%s %-40s –°–¢–ê–¢–£–°: %-3d (–≤—Ä–µ–º—è: %v)\n", emoji, r.URL, r.Status, r.Time.Round(time.Millisecond))
        }
    }
    
    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    fmt.Println("\n" + strings.Repeat("=", 60))
    fmt.Printf("–û–ë–†–ê–ë–û–¢–ê–ù–û: %d URL\n", len(urls))
    fmt.Printf("–£–°–ü–ï–®–ù–û:   %d\n", success)
    fmt.Printf("–° –û–®–ò–ë–ö–ê–ú–ò: %d\n", failed)
    fmt.Printf("–ú–ê–ö–°–ò–ú–£–ú –ì–û–†–£–¢–ò–ù: %d\n", maxWorkers)
    fmt.Printf("–û–ë–©–ï–ï –í–†–ï–ú–Ø: %v\n", elapsed.Round(time.Millisecond))
    
    // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π
    if len(urls) > maxWorkers {
        approxSequential := time.Duration(len(urls)/maxWorkers) * timeout
        fmt.Printf("–ü–†–ò–ú–ï–†–ù–û–ï –í–†–ï–ú–Ø –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–û–ô –ü–†–û–í–ï–†–ö–ò: ~%v\n", approxSequential)
        fmt.Printf("–£–°–ö–û–†–ï–ù–ò–ï: –ø—Ä–∏–º–µ—Ä–Ω–æ –≤ %.1f —Ä–∞–∑\n", float64(approxSequential)/float64(elapsed))
    }
}

var strings = struct {
    Repeat func(string, int) string
}{
    Repeat: func(s string, count int) string {
        var result strings.Builder
        for i := 0; i < count; i++ {
            result.WriteString(s)
        }
        return result.String()
    },
}
–§–∞–π–ª: url_checker_test.go

go
package main

import (
    "context"
    "testing"
    "time"
)

func TestWorkerPool(t *testing.T) {
    urls := []string{
        "https://httpbin.org/status/200",
        "https://httpbin.org/status/404",
    }
    
    wp := NewWorkerPool(2, 5*time.Second)
    ctx := context.Background()
    
    results := wp.ProcessUrls(ctx, urls)
    
    if len(results) != len(urls) {
        t.Errorf("–û–∂–∏–¥–∞–ª–æ—Å—å %d —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –ø–æ–ª—É—á–µ–Ω–æ %d", len(urls), len(results))
    }
}

func TestTimeout(t *testing.T) {
    urls := []string{
        "https://httpbin.org/delay/10", // –î–æ–ª–≥–∏–π –∑–∞–ø—Ä–æ—Å
    }
    
    wp := NewWorkerPool(1, 1*time.Second)
    ctx := context.Background()
    
    results := wp.ProcessUrls(ctx, urls)
    
    if results[0].Err == nil {
        t.Error("–û–∂–∏–¥–∞–ª–∞—Å—å –æ—à–∏–±–∫–∞ —Ç–∞–π–º–∞—É—Ç–∞")
    }
}

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É –ø—Ä–æ–µ–∫—Ç–∞:
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª—ã:


touch url_checker.go url_checker_test.go
–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É:


go run url_checker.go
–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã:


go test -v
–ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):


# –°–±–æ—Ä–∫–∞ —Å —Ñ–ª–∞–≥–∞–º–∏
go build -o checker url_checker.go

# –ó–∞–ø—É—Å–∫ —Å –∑–∞–º–µ—Ä–æ–º –ø–∞–º—è—Ç–∏
time ./checker

–ß—Ç–æ –≤—ã –Ω–∞—É—á–∏–ª–∏—Å—å –¥–µ–ª–∞—Ç—å:
–ó–∞–ø—É—Å–∫–∞—Ç—å –≥–æ—Ä—É—Ç–∏–Ω—ã —Å go
–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≥–æ—Ä—É—Ç–∏–Ω—ã —Å WaitGroup
–ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –∫–∞–Ω–∞–ª—ã
–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å —á–∏—Å–ª–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–∏–≥–Ω–∞–ª—ã –∏ —Ç–∞–π–º–∞—É—Ç—ã
–°–æ–∑–¥–∞–≤–∞—Ç—å worker pool
–°—Ç—Ä–æ–∏—Ç—å –≥–æ—Ç–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

üìà –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
–î–ª—è 12 URL —Å 5 –≤–æ—Ä–∫–µ—Ä–∞–º–∏:
–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è: ~4-6 —Å–µ–∫—É–Ω–¥
–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è: ~30+ —Å–µ–∫—É–Ω–¥
–£—Å–∫–æ—Ä–µ–Ω–∏–µ: –≤ 5-7 —Ä–∞–∑!

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è:
–°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ñ–∞–π–ª JSON
–î–æ–±–∞–≤—å—Ç–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ (retry) –¥–ª—è –Ω–µ—É–¥–∞—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
–†–µ–∞–ª–∏–∑—É–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ö–æ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
–î–æ–±–∞–≤—å—Ç–µ —Ü–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å
–°–¥–µ–ª–∞–π—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —á–∏—Ç–∞—Ç—å URL –∏–∑ —Ñ–∞–π–ª–∞

–ü–æ–∑–¥—Ä–∞–≤–ª—è—é! –í—ã –æ—Å–≤–æ–∏–ª–∏ –æ—Å–Ω–æ–≤—ã –≥–æ—Ä—É—Ç–∏–Ω –∏ –∫–∞–Ω–∞–ª–æ–≤ –≤ Go. –ü—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ—Å—å, —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å –∫–æ–¥–æ–º –∏ –ø—Ä–æ–±—É–π—Ç–µ —Ä–µ—à–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ —Å –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–æ–º!